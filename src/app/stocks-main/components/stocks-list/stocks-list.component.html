<h1>Stocks</h1>

<div class="search-container">
  <input
    pInputText
    type="text"
    placeholder="Search by name or symbol..."
    [ngModel]="searchTerm()"
    (ngModelChange)="searchTerm.set($event)"
    aria-label="Search stocks by name or symbol"
  />
</div>

<p-table
  [value]="filteredStocks()"
  [tableStyle]="{ 'min-width': '50rem' }"
  selectionMode="single"
  dataKey="stock.Id"
  (onRowSelect)="onRowSelect($event)"
  [rowsPerPageOptions]="[10, 25, 50]"
  [paginator]="true"
  [rows]="10"
>
  <ng-template #header>
    <tr>
      @for (column of columns; track column.key) {
        <th scope="col">{{ column.header }}</th>
      }
    </tr>
  </ng-template>
  <ng-template #body let-item>
    <tr [pSelectableRow]="item">
      @for (column of columns; track column.key) {
        @if (column.hasDynamicClass) {
          <td
            [class.positive]="(getClassValue(item, column) | changeClass) === 'positive'"
            [class.negative]="(getClassValue(item, column) | changeClass) === 'negative'"
            [class.neutral]="(getClassValue(item, column) | changeClass) === 'neutral'"
          >
            @if (column.pipe === 'formatPercent') {
              {{ getValue(item, column.field) | formatPercent }}
            } @else {
              {{ getValue(item, column.field) }}
            }
          </td>
        } @else if (column.directionField) {
          <td
            [class.positive]="getDirectionClass(item, column) === 'positive'"
            [class.negative]="getDirectionClass(item, column) === 'negative'"
            [class.neutral]="getDirectionClass(item, column) === 'neutral'"
          >
            @if (column.pipe === 'formatPrice') {
              {{ getValue(item, column.field) | formatPrice: getPipeArg(item, column) }}
            } @else {
              {{ getValue(item, column.field) }}
            }
            <span class="direction-arrow">{{ getDirectionArrow(item, column) }}</span>
          </td>
        } @else if (column.highlightSearch) {
          <td [innerHTML]="getValue(item, column.field) | highlightSearch: searchTerm()"></td>
        } @else {
          <td>
            @if (column.pipe === 'formatPrice') {
              {{ getValue(item, column.field) | formatPrice: getPipeArg(item, column) }}
            } @else if (column.pipe === 'formatPercent') {
              {{ getValue(item, column.field) | formatPercent }}
            } @else {
              {{ getValue(item, column.field) }}
            }
          </td>
        }
      }
    </tr>
  </ng-template>
  <ng-template #emptymessage>
    <tr>
      @if (searchTerm()) {
        <td [attr.colspan]="columns.length">No results found for "{{ searchTerm() }}"</td>
      } @else {
        <td [attr.colspan]="columns.length">Loading stocks...</td>
      }
    </tr>
  </ng-template>
</p-table>
